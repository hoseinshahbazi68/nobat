<div class="chat-modal-container">
  <div class="chat-header">
    <div class="header-info">
      <div class="support-avatar">
        <span class="avatar-icon">ğŸ’¬</span>
      </div>
      <div class="header-text">
        <h3 class="chat-title">Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†</h3>
        <span class="status-text">
          <span class="status-dot" [class.online]="isSupportOnline" [class.offline]="!isSupportOnline"></span>
          {{ isSupportOnline ? 'Ø¢Ù†Ù„Ø§ÛŒÙ†' : 'Ø¢ÙÙ„Ø§ÛŒÙ†' }}
        </span>
      </div>
    </div>
    <button class="btn-close" (click)="closeChat()" aria-label="Ø¨Ø³ØªÙ† Ú†Øª">
      <span>âœ•</span>
    </button>
  </div>

  <div class="chat-messages" #chatMessages>
    <!-- ÙˆØ±ÙˆØ¯ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ -->
    <div *ngIf="showPhoneInput" class="phone-input-container">
      <div class="phone-input-wrapper">
        <label for="phoneNumber">Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„:</label>
        <input type="tel" id="phoneNumber" [(ngModel)]="phoneNumber" placeholder="09123456789" class="phone-input"
          (keydown.enter)="initializeChat()" maxlength="11">
        <button class="btn-start-chat" (click)="initializeChat()" [disabled]="!phoneNumber">
          Ø´Ø±ÙˆØ¹ Ú†Øª
        </button>
      </div>
    </div>

    <div *ngIf="isLoading" class="loading-messages">
      <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§...</p>
    </div>
    <div *ngFor="let message of messages" class="message" [class.user-message]="message.sender === 'user'"
      [class.support-message]="message.sender === 'support'">
      <div class="message-avatar" *ngIf="message.sender === 'support' && message.supportUserName">
        <span class="avatar-icon">ğŸ‘¤</span>
      </div>
      <div class="message-content">
        <div class="message-sender" *ngIf="message.sender === 'support' && message.supportUserName">
          {{ message.supportUserName }}
        </div>
        <div class="message-text">{{ message.text || message.message }}</div>
        <div class="message-time">{{ formatTime(message.timestamp || message.createdAt) }}</div>
      </div>
    </div>

    <div *ngIf="isTyping" class="message support-message typing-indicator">
      <div class="message-content">
        <div class="typing-dots">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
  </div>

  <div class="chat-input-container" *ngIf="!showPhoneInput">
    <div class="input-wrapper">
      <textarea [(ngModel)]="newMessage" (keydown)="onKeyPress($event)" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."
        class="chat-input" rows="1" #messageInput></textarea>
      <button class="btn-send" (click)="sendMessage()" [disabled]="!newMessage.trim() || isTyping"
        aria-label="Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…">
        <span class="send-icon">ğŸ“¤</span>
      </button>
    </div>
  </div>
</div>
